<!DOCTYPE html><meta charset="utf-8"><title>Google App EngineのGolang 1.12でファイルの読み書きテスト | egashira.jp</title><meta name="description" content="Google App Engineで静的ファイルの読み書きをテストしてみます。"><meta property="og:title" content="Google App EngineのGolang 1.12でファイルの読み書きテスト | egashira.jp"><meta property="og:description" content="Google App Engineで静的ファイルの読み書きをテストしてみます。"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="stylesheet" href="/style.css"><link rel="alternate" type="application/atom+xml" href="https://egashira.jp/atom.xml" title="Atom"><div id="wrap"><header><a href="/"><svg width="240" height="50" viewBox="0 0 480 100"><path fill="none" stroke="#fff" stroke-width="9" stroke-linecap="square" stroke-linejoin="bevel" d="M237 61v1h26V49h-26V36h26v1M437 76V36h26v26h-26M367 36h26v26h-26V48h26M423 24v1M117 49h26V36h-26v26h26M183 62h-26V36h26v39h-21M197 36h26v26h-26V48h26M278 24v38M287 36h18v26M319 24v1M319 36v26M334 62V36h19M409 61v1M423 36v38h-15"/><path fill="#fff" d="M5.4 38.2c-1.8 2-2.4 5-2.5 8L0 85c-.2 7 8 15 15 15l39-2.8c2.8 0 5.8-.5 7.7-2.4l36.5-36.6c3-3 2.2-8.5-1.7-12.4L54.2 3.5c-4-4-9.4-4.7-12.4-1.7L5.4 38.2zm46.8 48.5l-20.2 1L12.4 68l1-20L40 21c1.5-1.4 4.2-1 6.2 1 2 1.8 2.3 4.6 1 6L22.4 53c-2 1.8-1.4 5.2 1 7.7 2.5 2.4 6 3 7.8 1L56 37c1.3-1.4 4-1 6 1s2.4 4.7 1 6L38.2 69c-1.8 1.8-1.3 5.3 1 7.7 2.5 2.4 6 3 7.8 1L71.8 53c1.5-1.5 4.3-1 6.2.8 2 2 2.3 4.7.8 6.2L52.2 86.6z"/></svg></a></header><article><h1>Google App EngineのGolang 1.12でファイルの読み書きテスト</h1><p class="updated">2020-02-19</p><p class="abst">Google App Engineで静的ファイルの読み書きをテストしてみます。</p><p>Google App Engineが第二世代になって、利用できるAPIが大きく変更されました。また、静的ファイルへのアクセスができるようになったので、その読み書きができるか検証してみたいと思います。</p><p>ここで静的ファイルというのは、app.yamlに以下のような記述をして外部から読み出すことができるようにしたファイルです。</p><pre><code data-lang="yaml"><span class="bullet">-</span> <span class="attr">url:</span> <span class="string">/test.txt</span>
  <span class="attr">static_files:</span> <span class="string">statics/test.txt</span>
  <span class="attr">upload:</span> <span class="string">statics/test.txt</span>
  <span class="attr">mime_type:</span> <span class="string">text/plain</span>
</code></pre><p>このファイルの内容は、以下のようなGolangのコードで読み出せます。</p><pre><code data-lang="go">   data, err := ioutil.ReadFile(<span class="string">"statics/test.txt"</span>)
   <span class="keyword">if</span> err != <span class="literal">nil</span> {
      log.Fatal(err)
   }
   fmt.Fprintf(w, <span class="string">"%s"</span>, data)
</code></pre><p>次に、以下のようなコードでファイルに書き込みます。</p><pre><code data-lang="go">   err := ioutil.WriteFile(<span class="string">"statics/test.txt"</span>, []<span class="keyword">byte</span>(<span class="string">"書き込み成功!"</span>), <span class="number">0644</span>)
   <span class="keyword">if</span> err != <span class="literal">nil</span> {
      fmt.Fprintf(w, <span class="string">"Error: %v"</span>, err)
   }
</code></pre><p>これをローカルで実行すると、エラーなく正常に実行できて、test.txtには「書き込み成功!」の文字が書き込まれます。</p><p>ちなみに、Golang 1.12で実行するためにapp.yamlには runtime:　go112 の設定が必要ですが、App Engineのローカル開発環境では、go112を受け付けないので、ローカル実行時には go111を設定しました。</p><p>ローカルでうまくいったので本サーバにアップして確認したところ、読み出しはうまくいきますが、</p><pre><code data-lang="bash">Error: open statics/test.txt: <span class="built_in">read</span>-only file system
</code></pre><p>エラーになりました。当然といえば当然です。もしこれで書き込みできるのであれば、簡単なものはデータベースなどを使わずにすむ算段でしたが、素直に別の方法を考える必要があります。</p><tag-button>Golang</tag-button><tag-button>Google App Engine</tag-button></article><nav></nav></div><footer><p>Copyright © 2007-2020 <a href="//egashira.jp/">egashira.jp</a> All rights reserved.</p></footer><script src="/base.js" async></script>